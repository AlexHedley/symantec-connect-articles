<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="author" content="AlexHedley">

  <title>Symantec Connect - Workflow - SMP - ASDK - Asset Ownership</title>

  <link rel="canonical" href='https://alexhedley.github.io/symantec-connect-articles/posts/workflow-smp-asdk-asset-ownership'>

      <link type="application/rss+xml" rel="alternate" title="Symantec Connect" href="/symantec-connect-articles/feed.rss" />
      <link type="application/atom+xml" rel="alternate" title="Symantec Connect" href="/symantec-connect-articles/feed.atom" />

  <meta name="application-name" content='Symantec Connect' />
  <meta name="msapplication-tooltip" content='Symantec Connect' />
  <meta name="msapplication-starturl" content='/symantec-connect-articles/' />

  <meta property="og:title" content='Symantec Connect - Workflow - SMP - ASDK - Asset Ownership' />
    <meta property="og:image" content='/symantec-connect-articles/images/header.png' />
  <meta property="og:type" content="website" />
  <meta property="og:url" content='https://alexhedley.github.io/symantec-connect-articles/posts/workflow-smp-asdk-asset-ownership' />

  <link rel="icon" href='/symantec-connect-articles/favicon.ico'>

  <!-- Custom fonts for this template -->
  <link href='/symantec-connect-articles/vendor/fontawesome-free/css/all.min.css' rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" data-no-mirror>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" data-no-mirror>

  <!-- Styles for this template (also includes Bootstrap) -->
  <link href='/symantec-connect-articles/scss/clean-blog.css' rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js" data-no-mirror></script>
  <script src="https://cdn.jsdelivr.net/npm/quicklink@2.3.0/dist/quicklink.umd.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism.css" rel="stylesheet">

  <link href="/symantec-connect-articles/scss/TabGroup.css" rel="stylesheet" type="text/css">

  

</head>

<body>

  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand" href='/symantec-connect-articles/'>Symantec Connect</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
      Menu
      <i class="fas fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ms-auto">
          <li class="nav-item">
    <a class="nav-link" href="/symantec-connect-articles/posts">Posts</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/symantec-connect-articles/tags">Tags</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/symantec-connect-articles/stats">Stats</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/symantec-connect-articles/about">About</a>
  </li>

          <li class="nav-item">
            <span class="nav-link">
              <form class="form-inline my-2 my-lg-0" action="/symantec-connect-articles/search" method="GET">
                <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search" name="query">
                <input type="submit" hidden />
              </form>
            </span>
          </li>
      </ul>
    </div>
  </div>
</nav>


  <!-- Page Header -->
  <header class="masthead" style="background-image: url(&quot;/symantec-connect-articles/images/header.png&quot;)">
  <div class="container position-relative">
    <div class="row">
      <div class="col-md-12">
        <div class='post-heading'>
          <h1>
            Workflow - SMP - ASDK - Asset Ownership
          </h1>
            <div class="meta">Published on Friday 9 October 2015</div>
              <div class="mt-3">
                  <a href="/symantec-connect-articles/tags/workflow" class="badge text-bg-light"> Workflow</a>
                  <a href="/symantec-connect-articles/tags/smp" class="badge text-bg-light"> SMP</a>
                  <a href="/symantec-connect-articles/tags/asdk" class="badge text-bg-light"> ASDK</a>
              </div>
        </div>
      </div>
    </div>
  </div>
</header>


  <!-- Main Content -->
  <div class="container">
    <div class="row">
      <div id="content" class="col-md-12">
        <p>In this Article I'm going to explain how Asset Ownership is controlled in the <img src="images/smp.png" alt="smp" /> SMP and how to maintain it using <img src="images/Workflow.png" alt="Workflow" /> Workflow and the ASDK.</p>
<p>Let's look at it in the SMP first.</p>
<p>Home | Service and Asset Management | Manage Configuration Items</p>
<p>Let's find a <img src="images/Computer.png" alt="Computer" /> Computer</p>
<p><img src="images/Folder-.png" alt="Folder (-)" /> CI Management | <img src="images/Folder.png" alt="Folder" /> Computers and Peripherals | <img src="images/Computer.png" alt="Computer" /> Computer</p>
<p>Search for one and Right-Click | <img src="images/Edit.png" alt="Edit ()" /> Edit</p>
<p>Scroll down to <strong>Asset Owners</strong> and &quot;Click to select...&quot; or click the <img src="images/Edit.png" alt="Edit" />Edit button</p>
<p><img src="images_Edit-Computer-AssetOwners.png" alt="Edit - Computer - Asset Owners" /></p>
<p>This can either be a User or a Department.</p>
<p>Search for the User, select and click OK.</p>
<p>This is configured using a Resource Association.</p>
<p>There are two, one for User and one for Department.</p>
<p><img src="images/ReportsFolder.png" alt="Reports Folder" /> Settings | <img src="images/Folder.png" alt="Folder" /> Notification Server | <img src="images/Folder.png" alt="Folder" /> Resource and Data Class Settings | <img src="images/Folder.png" alt="Folder" /> Resource Associations | <img src="images/Folder.png" alt="Folder" /> CMDB Association Types | <img src="images/ResourceAssociation.png" alt="Resource Association" /> Asset User Owner</p>
<table>
<thead>
<tr>
<th>​GUID</th>
<th>'ed35a8d1-bf60-4771-9dde-092c146c485a'</th>
</tr>
</thead>
</table>
<p><img src="images/ReportsFolder.png" alt="Reports Folder" /> Settings | <img src="images/Folder.png" alt="Folder" /> Notification Server | <img src="images/Folder.png" alt="Folder" /> Resource and Data Class Settings | <img src="images/Folder.png" alt="Folder" /> Resource Associations | <img src="images/Folder.png" alt="Folder" /> CMDB Association Types | <img src="images/ResourceAssociation.png" alt="Resource Association" />  Asset Department Owner</p>
<table>
<thead>
<tr>
<th>​GUID</th>
<th>'1466e770-4413-4517-a89d-6599b8a7f144'</th>
</tr>
</thead>
</table>
<p>You can see who is associated to what with the following SQL:</p>
<pre><code>SELECT * 
FROM ResourceAssociation ra
WHERE ra.ResourceAssociationTypeGuid = 'ed35a8d1-bf60-4771-9dde-092c146c485a'
</code></pre>
<p>So we need to create an Association, let's look to the SDK.</p>
<p>There's a &quot;Create Resource Association​&quot; we can use.</p>
<ul>
<li>http://localhost/altiris/asdk.ns/ResourceManagementService.asmx?op=CreateResourceAssociation</li>
</ul>
<p>Inputs:</p>
<ul>
<li>resourceAssociationTypeGuid</li>
<li>parentResourceGuid (<em>Asset</em>)</li>
<li>childResourceGuid (<em>User</em>)</li>
</ul>
<p>Create a <img src="images/Int.png" alt="Int" /> Web Service Generator (<a href="https://community.broadcom.com/symantecenterprise/viewdocument?DocumentKey=7d413f83-dd96-4e73-9f5e-b4e0d7c21bab&amp;CommunityKey=492058b4-42be-43e7-991d-986f1ea9ba7f&amp;tab=librarydocuments">Video</a>)</p>
<p>We can now call this in our <img src="images/Workflow.png" alt="Workflow" /> WF.</p>
<p>Try this then check the SQL and the RA Table should reflect this but if you then check in the <img src="images/smp.png" alt="smp" /> SMP the <strong>Asset Owners</strong> section won't, what's going on?</p>
<p>(Other Associations work just fine)</p>
<p>Let's do some investigation, I like to use both a SQL Profiler and the Altiris Profiler.</p>
<p>We have a call to 'spResourceAssociationsInsert', this makes sense.</p>
<pre><code>EXECUTE spResourceAssociationsInsert 
   &#64;ResourceAssociationTypeGuid=N'ed35a8d1-bf60-4771-9dde-092c146c485a', 
  &#64;ParentResourceGuid=N'e4fc9fc1-a75a-4532-8a82-159d2477d0fa', 
  &#64;ChildResourceGuid=N'f90f37c8-4562-48be-b8f3-3b0b4123086b', 
  &#64;HistoryEnabled=1
</code></pre>
<p>But there is also another call to insert values into another Table (Inv_Ownership_Details).</p>
<pre><code>INSERT INTO 
  dbo.[Inv_Ownership_Details] ([_ResourceGuid], [Owner], [Ownership Percentage]) 
VALUES 
  ('e4fc9fc1-a75a-4532-8a82-159d2477d0fa', 'f90f37c8-4562-48be-b8f3-3b0b4123086b', 100)
</code></pre>
<p>Now we could just create a SQL Generator but I don't like to use these for any ALTER commands.</p>
<p>There must be a better way.</p>
<p>Let's have another look at those Web Services:</p>
<p><strong>Save Data Class</strong> from <strong>Resource Model</strong>looks like it should work</p>
<ul>
<li>http://localhost/altiris/nswebservice/resourcemodel.asmx?op=SaveDataClass</li>
</ul>
<p>Add that to our previous <img src="images/Int.png" alt="Int" /> Integration component and try it out in <img src="images/Workflow.png" alt="Workflow" /> WF.</p>
<p>This just doesn't work, there is no way to pass in any dynamic data so this can't be a viable solution.</p>
<p><a href="https://www-secure.symantec.com/connect/user/toomas">Toomas</a> was a great help and got us some sample code from the Asset Team.</p>
<pre><code>using System;
using Client.ProxyClass;

namespace client
{class Program{	static readonly Guid OwnershipDetailsDataclassGuid = new Guid(&quot;0cd0318b-ad51-4d38-8ea3-2612d12189de&quot;);	private const string UserId = &quot;put here user name&quot;;	private const string Password = &quot;put here user password&quot;;
	static void Main(string[] args)	{
		var comp = new Guid(&quot;927a7afe-ab4d-40d1-b11f-72111e6d540d&quot;); //&lt;-set up computer guid		var user = new Guid(&quot;e0b8a57b-9b2b-4f07-8b9e-d66a3d65d678&quot;); //&lt;-set up user guid
		var field0 = new DataClassFieldData { FieldName = &quot;Owner&quot;, Value = user };		var field1 = new DataClassFieldData { FieldName = &quot;Ownership Percentage&quot;, Value = 100.0 };		var row = new DataClassRowData { DataElements = new[] { field0, field1 } };		var dcd = new DataClassData		{			DataClassGUID = OwnershipDetailsDataclassGuid,			DataRows = new[] { row }		};
		var client = new ResourceModelService {Credentials = new System.Net.NetworkCredential(UserId, Password)};		client.SaveDataClass(comp, new[] { dcd });	}}
}
</code></pre>
<p>We tested this and got the <strong>Inv_Ownership_Details</strong> Table updating but how do we translate this into <img src="images/Workflow.png" alt="Workflow" /> WF?</p>
<p>Maybe the <img src="images/CodeScriptComponent.png" alt="Code (Script) Component" /> Script Generator? Or why don't we build a Component?</p>
<p>Where do we start?</p>
<ul>
<li>Symantec™ Workflow 7.5 Component Developer Guide
<ul>
<li><a href="https://support.symantec.com/en_US/article.DOC5940.html">https://support.symantec.com/en_US/article.DOC5940.html</a></li>
</ul>
</li>
<li>Symantec™ Workflow 7.6 Component Developer Guide
<ul>
<li><a href="https://support.symantec.com/en_US/article.DOC8166.html">https://support.symantec.com/en_US/article.DOC8166.html</a></li>
</ul>
</li>
</ul>
<p>That's a lengthy process in itself so that can be discussed in a future Article.</p>
<p><a href="http://www.symantec.com/connect/user/christophermcewen">Chris</a>, a fellow Protirus C# Dev, got to work and created a Component we could use.</p>
<ul>
<li><img src="images/dll.png" alt="dll" /> Protirus.AssetOwner.Service.dll</li>
</ul>
<p>If you'd like a copy of this do get in touch <a href="mailto:info@Protirus.com?subject=Protirus.AssetOwner.Service.dll&amp;body=Workflow%20Asset%20Owner%20Component">info&#64;protirus.com</a></p>
<p>One last thing we need to do in our Workflow is to check if there is already an Owner Association before creating one, we can use the <strong>Break Association</strong> Web Service from <strong>Resource Model</strong>.</p>
<ul>
<li>http://localhost/altiris/nswebservice/resourcemodel.asmx?op=BreakAssociation</li>
</ul>
<p>Now with a combination of the Break Association, Create Association and our new dll any Asset Ownership changes will now be reflected in the SMP.</p>
<hr />
<p><u>Useful Documents</u></p>
<p>&quot;&lt;Install Drive&gt;:\Program Files\Altiris\Altiris ASDK\Help\ASDK7.6.chm&quot;</p>
<hr />
<p><u>Web Services</u></p>
<ul>
<li><p><strong>Resource Model</strong></p>
<ul>
<li>http://localhost/altiris/nswebservice/resourcemodel.asmx
<ul>
<li>Break Association
<ul>
<li>http://localhost/altiris/nswebservice/resourcemodel.asmx?op=BreakAssociation</li>
</ul>
</li>
<li>Remove Data Class From Resource
<ul>
<li>http://localhost/altiris/nswebservice/resourcemodel.asmx?op=RemoveDataClassFromResource</li>
</ul>
</li>
<li>Save Data Class
<ul>
<li>http://localhost/altiris/nswebservice/resourcemodel.asmx?op=SaveDataClass</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Resource Management Service</strong></p>
<ul>
<li>http://localhost/altiris/asdk.ns/ResourceManagementService.asmx​
<ul>
<li>Create Resource Association​
<ul>
<li>http://localhost/altiris/asdk.ns/ResourceManagementService.asmx?op=CreateResourceAssociation</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr />
<p><u>Symantec Case Info</u></p>
<table>
<thead>
<tr>
<th>Case Number</th>
<th>08713954</th>
<th>ETrack</th>
<th>ET3830607</th>
</tr>
</thead>
</table>
<hr />
<p><a href="http://www.protirus.com/"><img src="images/Protirus.png" alt="Protirus.png" /></a></p>


        

      </div>
    </div>
  <div id="comments-container" class="row">
    <script src="https://giscus.app/client.js"
        data-repo='alexhedley/symantec-connect-articles'
        data-repo-id='R_kgDOH723Rw'
        data-category-id='DIC_kwDOH723R84CXRav'
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="light"
        data-lang="en"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script>

  </div>
  </div>

  <hr>

  <!-- Footer -->
  <footer>
  <div class="container">
    <div class="row">
      <div class="col-md-12 text-center">
        <p class="copyright">&#xA9; Alex Hedley 2015-2020</p>

        <ul class="list-inline text-center small">
            <li class="list-inline-item">
              <a href="/symantec-connect-articles/feed.rss"><i class="fa fa-rss"></i> RSS Feed</a>
            </li>
            <li class="list-inline-item">
              <a href="/symantec-connect-articles/feed.atom"><i class="fa fa-rss"></i> Atom Feed</a>
            </li>
        </ul>
        <br />
        <div class="font-weight-bold small"><a href="https://statiq.dev">Generated by Statiq</a></div>
      </div>
    </div>
  </div>
</footer>


  <!-- Scripts -->
  <script src='/symantec-connect-articles/vendor/bootstrap/js/bootstrap.bundle.min.js'></script>
  <script src='/symantec-connect-articles/vendor/startbootstrap-clean-blog/js/scripts.js'></script>
  <script src='/symantec-connect-articles/js/clean-blog.js'></script>
      <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-CQV2ZWNX32"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-CQV2ZWNX32');
    </script>
  

</body>

</html>
