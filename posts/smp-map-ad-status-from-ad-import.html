<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="author" content="AlexHedley">

  <title>Symantec Connect - SMP - Map AD Status from AD Import</title>

  <link rel="canonical" href='https://alexhedley.github.io/symantec-connect-articles/posts/smp-map-ad-status-from-ad-import'>

      <link type="application/rss+xml" rel="alternate" title="Symantec Connect" href="/symantec-connect-articles/feed.rss" />
      <link type="application/atom+xml" rel="alternate" title="Symantec Connect" href="/symantec-connect-articles/feed.atom" />

  <meta name="application-name" content='Symantec Connect' />
  <meta name="msapplication-tooltip" content='Symantec Connect' />
  <meta name="msapplication-starturl" content='/symantec-connect-articles/' />

  <meta property="og:title" content='Symantec Connect - SMP - Map AD Status from AD Import' />
    <meta property="og:image" content='/symantec-connect-articles/images/header.png' />
  <meta property="og:type" content="website" />
  <meta property="og:url" content='https://alexhedley.github.io/symantec-connect-articles/posts/smp-map-ad-status-from-ad-import' />

  <link rel="icon" href='/symantec-connect-articles/favicon.ico'>

  <!-- Custom fonts for this template -->
  <link href='/symantec-connect-articles/vendor/fontawesome-free/css/all.min.css' rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" data-no-mirror>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" data-no-mirror>

  <!-- Styles for this template (also includes Bootstrap) -->
  <link href='/symantec-connect-articles/scss/clean-blog.css' rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js" data-no-mirror></script>
  <script src="https://cdn.jsdelivr.net/npm/quicklink@2.3.0/dist/quicklink.umd.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism.css" rel="stylesheet">

  <link href="/symantec-connect-articles/scss/TabGroup.css" rel="stylesheet" type="text/css">

  

</head>

<body>

  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand" href='/symantec-connect-articles/'>Symantec Connect</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
      Menu
      <i class="fas fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ms-auto">
          <li class="nav-item">
    <a class="nav-link" href="/symantec-connect-articles/posts">Posts</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/symantec-connect-articles/tags">Tags</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/symantec-connect-articles/stats">Stats</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/symantec-connect-articles/about">About</a>
  </li>

          <li class="nav-item">
            <span class="nav-link">
              <form class="form-inline my-2 my-lg-0" action="/symantec-connect-articles/search" method="GET">
                <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search" name="query">
                <input type="submit" hidden />
              </form>
            </span>
          </li>
      </ul>
    </div>
  </div>
</nav>


  <!-- Page Header -->
  <header class="masthead" style="background-image: url(&quot;/symantec-connect-articles/images/header.png&quot;)">
  <div class="container position-relative">
    <div class="row">
      <div class="col-md-12">
        <div class='post-heading'>
          <h1>
            SMP - Map AD Status from AD Import
          </h1>
            <div class="meta">Published on Thursday 8 October 2015</div>
              <div class="mt-3">
                  <a href="/symantec-connect-articles/tags/smp" class="badge text-bg-light"> SMP</a>
              </div>
        </div>
      </div>
    </div>
  </div>
</header>


  <!-- Main Content -->
  <div class="container">
    <div class="row">
      <div id="content" class="col-md-12">
        <p>In this Article I'm going to show you how to extend the User Resource to include extra properties you can retrieve from the AD Import to gain extra information about your user base. We are going to map the AD Status value (aka UserAccountControl)</p>
<p>First lets create a <img src="images/DataClasses.png" alt="Data Classes" /> Data Class to store this information.</p>
<p><img src="images/ReportsFolder.png" alt="Reports Folder" /> Settings | <img src="images/Folder.png" alt="Folder" /> Notification Server | <img src="images/Folder.png" alt="Folder" /> Resource and Data Class Settings | <img src="images/Folder.png" alt="Folder" /> Data Classes</p>
<p>Right-Click | New | Editable Data Class</p>
<p>Call it <strong>AD User Details</strong></p>
<p>Add some Fields</p>
<ul>
<li>ADStatus (Static List)</li>
<li>UserAccountControl (String/Integer)</li>
<li>LastUpdated (Date)</li>
</ul>
<p>For the Static List add the following values</p>
<ul>
<li>Active</li>
<li>Disabled</li>
<li>Deleted</li>
</ul>
<p>If we take a look at an AD User to see what value this is:</p>
<p><img src="images/AD-AccountDisabled.png" alt="AD - Account (Disabled)" /></p>
<p><img src="images/AD-AttributeEditor.png" alt="AD - Attribute Editor" /></p>
<p><img src="images/userAccountControl.png" alt="userAccountControl" /></p>
<p>What does 512 equate to?</p>
<p><a href="http://www.netvision.com/ad_useraccountcontrol.php">http://www.netvision.com/ad_useraccountcontrol.php</a></p>
<table>
<thead>
<tr>
<th><strong>Value</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>512</td>
<td>Enabled Account</td>
</tr>
<tr>
<td>514</td>
<td>Disabled Account</td>
</tr>
<tr>
<td>544</td>
<td>Enabled, Password Not Required</td>
</tr>
<tr>
<td>546</td>
<td>Disabled, Password Not Required</td>
</tr>
<tr>
<td>66048</td>
<td>Enabled, Password Doesn't Expire</td>
</tr>
<tr>
<td>66050</td>
<td>Disabled, Password Doesn't Expire</td>
</tr>
<tr>
<td>66080</td>
<td>Enabled, Password Doesn't Expire &amp; Not Required</td>
</tr>
<tr>
<td>66082</td>
<td>Disabled, Password Doesn't Expire &amp; Not Required</td>
</tr>
<tr>
<td>262656</td>
<td>Enabled, Smartcard Required</td>
</tr>
<tr>
<td>262658</td>
<td>Disabled, Smartcard Required</td>
</tr>
<tr>
<td>262688</td>
<td>Enabled, Smartcard Required, Password Not Required</td>
</tr>
<tr>
<td>262690</td>
<td>Disabled, Smartcard Required, Password Not Required</td>
</tr>
<tr>
<td>328192</td>
<td>Enabled, Smartcard Required, Password Doesn't Expire</td>
</tr>
<tr>
<td>328194</td>
<td>Disabled, Smartcard Required, Password Doesn't Expire</td>
</tr>
<tr>
<td>328224</td>
<td>Enabled, Smartcard Required, Password Doesn't Expire &amp; Not Required</td>
</tr>
<tr>
<td>328226</td>
<td>Disabled, Smartcard Required, Password Doesn't Expire &amp; Not Required</td>
</tr>
</tbody>
</table>
<p>Let's map this value into the new Data Class with the AD Import.</p>
<p><img src="images/ReportsFolder.png" alt="Reports Folder" /> Settings | <img src="images/Folder.png" alt="Folder" /> Notification Server | <img src="images/MicrosoftActiveDirectoryImport.png" alt="Microsoft Active Directory Import" /> Microsoft Active Directory Import</p>
<p><img src="images/MicrosoftActiveDirectoryImport-Config.png" alt="Microsoft Active Directory Import - Config" /></p>
<p>Under &quot;User&quot; click on &quot;specified column mappings&quot;</p>
<p>Select the newly created Data Class</p>
<p><img src="images/ADImport-CoumnMappingsforUser.png" alt="AD Import - Coumn Mappings for User" /></p>
<p>Then click on UserAccountControl &quot;(null)&quot; to select a Field</p>
<p><img src="images/ADImport-Directoryentryattribute.png" alt="AD Import - Directory entry attribute" /></p>
<p>OK | OK</p>
<p>Run the Import Rule <img src="images/RunImportRule.png" alt="Run Import Rule" /></p>
<p>Now let's create a <img src="images/CMDBRule.png" alt="CMDB Rule" /> CMDB Rule to map this number to some text.</p>
<p><img src="images/ReportsFolder.png" alt="Reports Folder" /> Settings | <img src="images/Folder.png" alt="Folder" /> Notification Server | <img src="images/Folder.png" alt="Folder" /> Connector | <img src="images/Folder.png" alt="Folder" /> CMDB Rules</p>
<p><img src="images/CMDBRule-SetADStatus.png" alt="CMDB Rule - Set AD Status" /></p>
<table>
<thead>
<tr>
<th>Resource Type</th>
<th>User</th>
</tr>
</thead>
<tbody>
<tr>
<td>Target using</td>
<td>Sql Query</td>
</tr>
<tr>
<td>SQL query</td>
<td>&lt;below&gt;</td>
</tr>
</tbody>
</table>
<pre><code>SELECT 
    rru.[Guid],
    rru.Name,
    iaud.UserAccountControl,
    GetDate() AS CurrentDateTime
FROM 
    [RM_ResourceUser] rru
INNER JOIN 
    Inv_AD_User_Details iaud 
    ON iaud._ResourceGuid = rru.Guid
</code></pre>
<p>Choose the data class of the one you've just created:</p>
<p>I'm getting the current date from SQL.</p>
<table>
<thead>
<tr>
<th>LastUpdated</th>
<th>CurrentDateTime</th>
</tr>
</thead>
</table>
<hr />
<p>Anybody know how to get the current DateTime in an Expression?</p>
<p>I've tried the following</p>
<ul>
<li>Now()</li>
<li>Today()</li>
<li>DateTime.Today</li>
</ul>
<p>With and without equals...</p>
<ul>
<li><a href="https://community.broadcom.com/symantecenterprise/viewthread?MessageKey=a98001a0-57f5-4d71-851c-cff888119198&amp;CommunityKey=63b01f30-d5eb-43c7-9232-72362b508207&amp;tab=digestviewer#bma98001a0-57f5-4d71-851c-cff888119198">https://www-secure.symantec.com/connect/forums/cmdb-rule-help</a></li>
</ul>
<hr />
<p>In the 'AD Status' column choose &quot;&lt;Expression&gt;&quot; from the dropdown</p>
<p><u>Articles</u></p>
<ul>
<li>Scriptable fields for modifying Resource Import Export and CMDB rules <a href="https://support.symantec.com/en_US/article.HOWTO45608.html#v19412924">https://support.symantec.com/en_US/article.HOWTO45608.html#v19412924</a></li>
<li>Expression Functions <a href="https://support.symantec.com/en_US/article.HOWTO45613.html#v19412948">https://support.symantec.com/en_US/article.HOWTO45613.html#v19412948</a>
<ul>
<li><strong>IIF</strong> <a href="https://support.symantec.com/en_US/article.HOWTO45647.html#v22897377">https://support.symantec.com/en_US/article.HOWTO45647.html#v22897377</a></li>
</ul>
</li>
</ul>
<p>Now we can use a bunch of nested IIFs, it's not eloquent but it works.</p>
<pre><code>IIF([AD User Details.UserAccountControl]='512','Active',
 IIF([AD User Details.UserAccountControl]='514','Disabled',
  IIF([AD User Details.UserAccountControl]='544','Active',
   IIF([AD User Details.UserAccountControl]='546','Disabled',
    IIF([AD User Details.UserAccountControl]='66048','Active',
     IIF([AD User Details.UserAccountControl]='66050','Disabled',
      IIF([AD User Details.UserAccountControl]='66080','Active',
       IIF([AD User Details.UserAccountControl]='66082','Disabled',
        IIF([AD User Details.UserAccountControl]='262656','Active',
         IIF([AD User Details.UserAccountControl]='262658','Disabled',
          IIF([AD User Details.UserAccountControl]='262688','Active',
           IIF([AD User Details.UserAccountControl]='262690','Disabled',
            IIF([AD User Details.UserAccountControl]='328192','Active',
             IIF([AD User Details.UserAccountControl]='328194','Disabled',
              IIF([AD User Details.UserAccountControl]='328224','Active',
               IIF([AD User Details.UserAccountControl]='328226','Disabled','Deleted'
                ))))))))))))))))
</code></pre>
<p>I tried a CASE statement but it couldn't get it to verify.</p>
<p>Set a Schedule - a Shared one makes sense, match it to the AD Import.</p>
<hr />
<p><a href="http://www.protirus.com/"><img src="images/Protirus.png" alt="Protirus" /></a></p>


        

      </div>
    </div>
  <div id="comments-container" class="row">
    <script src="https://giscus.app/client.js"
        data-repo='alexhedley/symantec-connect-articles'
        data-repo-id='R_kgDOH723Rw'
        data-category-id='DIC_kwDOH723R84CXRav'
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="light"
        data-lang="en"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script>

  </div>
  </div>

  <hr>

  <!-- Footer -->
  <footer>
  <div class="container">
    <div class="row">
      <div class="col-md-12 text-center">
        <p class="copyright">&#xA9; Alex Hedley 2015-2020</p>

        <ul class="list-inline text-center small">
            <li class="list-inline-item">
              <a href="/symantec-connect-articles/feed.rss"><i class="fa fa-rss"></i> RSS Feed</a>
            </li>
            <li class="list-inline-item">
              <a href="/symantec-connect-articles/feed.atom"><i class="fa fa-rss"></i> Atom Feed</a>
            </li>
        </ul>
        <br />
        <div class="font-weight-bold small"><a href="https://statiq.dev">Generated by Statiq</a></div>
      </div>
    </div>
  </div>
</footer>


  <!-- Scripts -->
  <script src='/symantec-connect-articles/vendor/bootstrap/js/bootstrap.bundle.min.js'></script>
  <script src='/symantec-connect-articles/vendor/startbootstrap-clean-blog/js/scripts.js'></script>
  <script src='/symantec-connect-articles/js/clean-blog.js'></script>
      <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-CQV2ZWNX32"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-CQV2ZWNX32');
    </script>
  

</body>

</html>
